generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider     = "postgresql"
  url          = env("DATABASE_URL")
  directUrl    = env("DIRECT_URL")
  relationMode = "prisma"
}

model User {
  id                    String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email                 String                 @unique
  name                  String?
  image                 String?
  nickname              String?
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  isSubscribed          Boolean                @default(false)
  subscriptionEndDate   DateTime?
  lastLoginAt           DateTime?
  clerkId               String                 @unique
  roleId                String                 @default("USER")
  interest              Interest[]
  role                  UserRole               @relation(fields: [roleId], references: [id])
  watchedVideos         WatchedVideo[]
  orders                Order[]
  taughtWorkshops       Workshop[]             @relation("InstructorWorkshops")
  workshopRegistrations WorkshopRegistration[]
  favorites             Favorite[]
  cart                  Cart[]
  reviews               Review[]
}

model UserRole {
  id    String @id
  label String
  users User[]
}

model Video {
  id            String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  videoId       String         @unique
  title         String?
  description   String?
  uploadDate    DateTime       @default(now())
  price         Float?
  category      VideoCategory?
  thumbnail     String?
  courseId      String         @db.Uuid
  sectionId     String?        @db.Uuid
  course        Course         @relation("CourseToVideos", fields: [courseId], references: [id], onDelete: Cascade)
  section       Section?       @relation("SectionToVideos", fields: [sectionId], references: [id], onDelete: Cascade)
  watchedVideos WatchedVideo[]
}

model WatchedVideo {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId    String   @db.Uuid
  videoId   String   @db.Uuid
  watchedAt DateTime @default(now())
  progress  Float
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  video     Video    @relation(fields: [videoId], references: [id], onDelete: Cascade)

  @@unique([userId, videoId])
}

model Document {
  id              String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  documentId      String            @unique
  title           String?
  description     String?
  uploadDate      DateTime          @default(now())
  price           Float?
  bucketUrl       String
  category        DocumentCategory?
  thumbnail       String?
  isPublic        Boolean           @default(false)
  subTitle        String?
  subDescription  String?
  isMain          Boolean           @default(false)
  visualTitle1    String?
  visualTitle2    String?
  tableOfContents Json?
}

model Workshop {
  id            String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title         String
  description   String?
  startDate     DateTime
  endDate       DateTime
  price         Float?
  locationOrUrl String?
  status        WorkshopStatus         @default(RECRUITING)
  instructorId  String                 @db.Uuid
  createdAt     DateTime               @default(now())
  updatedAt     DateTime               @updatedAt
  thumbnail     String?
  instructor    User                   @relation("InstructorWorkshops", fields: [instructorId], references: [id])
  registrations WorkshopRegistration[]
}

model WorkshopRegistration {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId       String   @db.Uuid
  workshopId   String   @db.Uuid
  registeredAt DateTime @default(now())
  attended     Boolean  @default(false)
  orderId      String?  @db.Uuid
  order        Order?   @relation(fields: [orderId], references: [id], onDelete: SetNull)
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  workshop     Workshop @relation(fields: [workshopId], references: [id], onDelete: Cascade)

  @@unique([userId, workshopId])
}

model Order {
  id                    String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId                String?                @db.Uuid
  totalAmount           Float
  status                OrderStatus            @default(PENDING)
  stripePaymentIntentId String?                @unique
  stripeInvoiceId       String?                @unique
  stripeInvoiceUrl      String?
  orderedAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  user                  User?                  @relation(fields: [userId], references: [id], onDelete: SetNull)
  items                 OrderItem[]
  workshopRegistrations WorkshopRegistration[]
}

model OrderItem {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  orderId         String   @db.Uuid
  priceAtPurchase Float
  quantity        Int      @default(1)
  itemId          String
  itemType        ItemType
  order           Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
}

model Favorite {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId    String   @db.Uuid
  createdAt DateTime @default(now())
  itemId    String
  itemType  ItemType
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, itemType, itemId])
}

model Cart {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId    String   @db.Uuid
  createdAt DateTime @default(now())
  itemId    String
  itemType  ItemType
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, itemType, itemId])
}

model Image {
  id        String   @id @default(uuid())
  fileName  String
  url       String
  createdAt DateTime @default(now())
}

model Course {
  id                  String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title               String
  courseTitle         String?
  description         String?
  price               String?
  rating              Float?
  reviewCount         Int?
  category            CourseCategory?
  duration            String?
  level               String?
  language            String?
  backgroundImage     String?
  promoText           String?
  summary             String?
  detailTitle         String?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  targetAudienceTypes TargetAudienceType[]
  instructors         Instructor[]         @relation("CourseInstructors")
  videos              Video[]              @relation("CourseToVideos")
  sectionsRel         Section[]
  reviews             Review[]
}

model Review {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId    String   @db.Uuid
  courseId  String   @db.Uuid
  rating    Float
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  course    Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([courseId])
  @@index([userId])
}

model Section {
  id          String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  courseId    String        @db.Uuid
  title       String
  description String?
  orderIndex  Int
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  course      Course        @relation(fields: [courseId], references: [id], onDelete: Cascade)
  items       SectionItem[] @relation("SectionToItem")
  videos      Video[]       @relation("SectionToVideos")

  @@index([courseId])
}

model SectionItem {
  id         String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  sectionId  String  @db.Uuid
  title      String
  content    String
  orderIndex Int
  icon       String?
  section    Section @relation("SectionToItem", fields: [sectionId], references: [id], onDelete: Cascade)

  @@index([sectionId])
}

model Instructor {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name         String
  profileImage String?
  description  String?
  careers      Json?
  courses      Course[] @relation("CourseInstructors")
}

model GlobalRelatedItem {
  id        String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title     String
  content   String
  price     Float
  category  String
  type      String
  thumbnail String?
}

model CourseInstructors {
  A String @db.Uuid
  B String @db.Uuid

  @@id([A, B], map: "_CourseInstructors_AB_pkey")
  @@index([B], map: "_CourseInstructors_B_index")
  @@map("_CourseInstructors")
}

enum WorkshopStatus {
  RECRUITING
  CLOSED
  ONGOING
  COMPLETED
}

enum CourseCategory {
  INTERVIEW
  RESUME
  NETWORKING
}

enum VideoCategory {
  INTERVIEW
  RESUME
  NETWORKING
}

enum DocumentCategory {
  MARKETING
  IT
  DESIGN
  PUBLIC
  ACCOUNTING
  SERVICE
}

enum Interest {
  INTERVIEW
  RESUME
  NETWORKING
  MARKETING
  IT
  DESIGN
  PUBLIC
  ACCOUNTING
  SERVICE
}

enum OrderStatus {
  PENDING
  COMPLETED
  FAILED
  CANCELLED
  REFUNDED
}

enum ItemType {
  VIDEO
  DOCUMENT
  WORKSHOP
  COURSE
  EBOOK
}

enum TargetAudienceType {
  IT
  GOVERNMENT
  FINANCE
  DESIGN
  RESUME
  INTERVIEW
  NETWORKING
  SERVICE
}
